movements=list(">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>")
movements=list("><<>><<<>><>><<<<>><<>>>><<<<>>><>>><>><><><<<<>><<<>><<<>>>><>>>><<>>>><<>><<<><<<<>>><<<<>>>><<<<>><>>><<<<>><>>><<<>><<>>><<><<<<>><<<>><><>><>>>><<>><<<<><<><<<<><<<><<<>><<<<>><<<<>>><<<>>><<<<>>>><<<<>><<><<<<>>><><<<>>><<<>><<<>>>><<><<>>>><<<<><<>>><<<>><<<<>>><><<><<>><<>>>><>><<<>>>><<>>><>><<<>>><<<<>><<<<>>><<<<>>>><<>>>><>>><<<<>><<<<>>>><<<>><>>>><<>><<>><>><<<<>>><<<>>>><<<>>>><><>>>><<<><<<<>><<<<><<<>>>><<>>>><<<<>><<<<><<><<>>>><<<<>>><<<>>>><<<>>><>>>><<<>><<<<><>>><<<<>><<<<>>><><>>><<>><<<>>><<>>>><>>><<>><<<>>>><<<>><<<>>><><<<<><<<><<<<><<>><<<><<<><<<>><<>>><<>><<<<>>>><>><<<>>>><><<><<<<><<><<<><<>><<<>>>><<<>>>><<<<><>><<<<><<><>><<<<><<>><<<><><<><<>><><<<<><>><<>><<<>><<>>><<>>><><>><>>>><>>><<<<><<<<>><<<>>><<>><<<<>><<><>><<<>><><<<<><>>><<<<>>><>><>>><<><<<<>><<<<>>>><>><<>>>><>>>><<<>>><<<>>>><<<<>><<><<>>><<>><<<<>><>>><<>>><<>>>><<<<>><<<><<<>>><<<<><<<<>><<>>><<<<>>><<<<>>>><<><><<>>>><<<<>>><><><<>><<>>><>>>><>><<<<>><><>>><>><<<>><<>><<<<>><<>>>><><<<<>><<<>>><<><>><>>><<<>><<<<>>><<>>><>>><<<><<<<>><<>>><<>>><<>>><<<<>>>><<<>>><>>><<<>><>>>><<<>>>><<<<><>><<<<>>><<<>><<<<>><<>><<<>>>><<<>><<<<>><<<<><>>>><<<<>><<<<><<<>>><<<<><<<>>><>>><<<>><<>>>><<<><>><>>><<<>><><<<>><<><<<>>><<<<><<<>><<<>>>><>>>><>><<<<>>><<<<>>><>>><<><<<>><<>>><<<>>><<<<>>>><>><<<<>>>><<<>><<<>>>><<>><<<<>>><><<<><<<>>>><>>>><<<><>>><<<<><><<>><<<>>>><<<>>><>>><>>>><<<<>>>><><<<><<>>>><<>>><<<<>>><>>>><<<<>><<<<>>>><<><<<<>><<>><<<><<<<>>>><<<<>>><<<>><<>>>><><<<><<>>><<<<><<<<><>><>>>><<>><<<>>><>><<<>>>><<<>>><<><>><<<>><<<<>>><<<<><><<>>><<<<>>>><<>>>><<>>><<><<>><<>><<>><<<><><<>>>><<<>>>><>>>><<>><<>><<<<>><>>><<<><<>>><>>>><<<>>>><><<<<><<<>>>><<>><<<<>>><<<<><>>><<<><<>>>><<<<>>>><><<<>>><>><<><<>>>><<<>>><>><<<<><<<<>><<>>>><<<>>><><><<<<>>><<<>><<<>>><<>><<<<>>><<<<>>>><>>><>>><<<<>><<>><<<>>><<<<><<><<<<>><>>><<<<>><<<<>><<>><>><<<<>><<<<><>>>><<<><<<>>><><<>><<>><<>>>><<<>>>><<<<><<<<><><<<>>>><<<<><<<<><<><<<>><<<<>>><<<><<>><<<>>><<>>>><<<>><<<<><<<><<<<>>><<<>><<<<>>><<<<>><>>>><>>><<>>><<>><<>><<>><<>>><<<<><<<<>><<<<><<<<>>>><<<>>><>>>><><<>>>><>>><<<>><>>>><<>>><<<<>><<>><<<<>><<>>><<<<><><<>><<>>><<<<>>><<<><<>>><<<>>>><<>><>><<>>>><<<<>>>><><<<<>>>><>>><<>>>><<<<><<><<<<><<<<>><>><<<<><<<>>><<<>><>>><<<<>><<><<<<>>><>>>><<<>>><<<>>><<>>>><<<><>><<<>><<<><>>>><<>><<<<><<<<>>><<<>>>><><><<<>>><><>><<<<>><<><><<>>><>>><<<>>><<>>>><<>><<<>><>>><<>>><<<>><><<<><>><<><<<<><>>>><<<<>>>><>>><<>><<>>><<<<><<>>><<<<>>><<>>><><>>>><>>><>>>><<>><<>>>><>>>><>><<>><<<><<<>>>><<<<><<<<><>><<>>><<<<><<<>><<<><>>><><><<>><<>><>><<>>>><<<<><<><<>>><>><<>>>><<<<>>><<<>><<<>>><<>><<>>>><<<>>>><>>><>><>><<>>><<<<>>><<<<>>><<<><<<<>><<><<<>>><<<<>><<>>>><<<<>>>><<<>>>><<<<>>>><>><<><<>>>><<<<>>><<<<>>>><>>>><<<<><<<><<<<>><>>><>><><<<<>><<<<><<>>>><>>>><<<><<><<>>><<<>>>><<<>>><<<<>>><<>>><>>>><<<<>><<>>><><<<<><<><>>><<<<>>>><>><><<<>>>><>>>><<<<>>><<<>>>><<><>>><>>>><<<><>>>><<<<><<<<>>><>>><<<<>>><<<>>><<>>>><><<>><<<<>>>><<<><>>><>>>><<>>>><<>><<>>><<><<<>>>><<<>>>><<>>>><>>><<<<>>>><<<<>>>><<<<>>><<><<<<><>>>><>><<<><<>><<>><<>>>><<<<>>>><<<><<<>><<<>>><<<>>>><<><<><<<>><<<<>>><<<><<>><<><<>><<>>>><<>>><<<>><<<<><>><<<>>><>>><>><<><><>>><<><>><<<><>>>><<<>>><<<<>>><<<<>>><<><<>>>><>>><<<>>>><<<>><><<<<>><><<>>>><<<<>>><<<><<<<><<<><<>><<<><<<<>>>><><<<>>>><<<<>>>><<<<>>><<>>><<>><<<>>><>>>><><<>><<<<>>>><<>>>><<<>>><<>>><<<>>>><<<>>><<<>>><>>>><<>>><>>>><<<>><<>><<><<<>>><<<><<<<><<>>><<<>>>><<<<>><<>>><<<<>>>><>>><<>><<<<>><<><><<>>><<<<>>><<>><<<>><<>>>><<>><><>>><<<<>>>><>>><<>><>>>><<<<>>>><<<<>>>><><>><<<>>><<<><<><<<><<<<>>>><<><<<>>><>><>>><<<>>>><<<>>><<<>>>><<>>>><>><<<>>>><<><<<>><<<<>>><<><<<>><<<>>>><<<<>>><><<>>>><><>><<<>>><<>><>>>><<<<>><<<>>>><<<>>>><<>><<<<>>><<<>>><<<<>><>>><<<>>><<>><<><<>>><<<><<<<>><<<><<><<<>>>><<<>><>><><<<<>>><<>>><<<>>><<<<>>>><>>><<<>><<<<>><<<<>>>><<<>>>><<>>><<>><<<<>><<<>><<<<>>><<<<>>>><>><<<>>>><>><<<<>><<>><>>>><<<>>><<<<>>>><<>>>><>><>>><><>>><<><<<<>>><<<>>>><<<<>><<>>>><<<>>>><<<>>>><<<<>>><<><<<>>><<<>><<<<>>>><<<>>>><<<<><<<<>>><<<<>><<<>><<><<>>><<<<>>><><<<>><>>>><<<>><<<>><<<>>><>>>><<<<>>><<<>><<>>><<<>>>><<>><<><>>><<<>>>><<<><<><<>><<<>>>><>>>><<<>>><<<<><<<>><<<<>>><<<<>>><<><<>>><<<><<>>>><<<>><<<<>>><<<>>><<><<>>>><>>>><<<>>>><><<<>>><>>>><<>>><>>><<>><<><>>><<>>><>><<<><<<>>>><><<<><<<>>><<>>>><<<><<<<><<<<>>><<<<>>>><>><<<<><<<>>><>>><<><<<<>>><<>><<<<><><<>>><><<><>><<><<<<><<<>>><>>><<<<>><<>><<<><>>>><<<<>>>><<<<>>><><<><<<>>>><<>><<>><>>>><<>>><>>>><<<<>><>>>><>>>><<<<><<<<>><<>>>><<<><<><>>>><<<>>><<<>>><<<><>>>><>>><>>>><<>><<<<>>><<>>>><<>>><<>>><<<><<<><>><<<><>>><<>>>><<>>>><<><<>>><>>>><<<><<<<>>><>><<<<>>><<><<>>>><<<<><<<>>>><<>><<<>>>><>>><<><><<<><<<<>>><<<<>><<<<>><<<<>>><<<>>><<<>>><>><<<><<<><<<>><><<<>>>><<><<<><<<<>>>><>>>><<<><>>>><<<<>><>>>><<>><<>><<<><<<>>>><<<<>>><<<<>>>><>>><<<<>>>><>>><<<<>>>><<<<>>>><>>>><<<<><<<<><<<<>><>>><<<<><>>><<<<>>>><<<<>><<>>><<<<>><<<<><<<<>>>><<<<><<<<>>>><<<<>>>><<<<>>><<><<>>><<<<>>><<<>><<<>>>><<<>><>><<>>>><<<>><<<><<<>>>><<<<>>><<<><<<<>>><<<<>><<>><<>>><<>>>><>>><<><<<>>><<<><<>>><<<>><>><<<><<>>><<<><>>><<<><<><<><<>>><<<<><<<>>><>>><<<>>><<>><<>>><<>><>><<<><<<<><>>>><<<><<><<>>><<<>>>><<<<>>>><<<<><<>>>><<<>>><<<<>>><<<>><<<<>>>><>><><>>>><<>><<<<><<<>>><><>>><><>>><<>><<<<><<>><<<>>><<<><>>>><<<>><<>>>><<<><<>>>><<><<<><<<<>>>><>><<>><<<<>>><<>><<>>>><<<><<<>>><<<>>><<<<>><<<><>><<<<>>>><<<<>><<<<>>>><<<<>>><><<<<>>>><<>><>>><<<<>>><<<<>>>><<>>>><>>>><<>><<<<>><<<<>><<>>>><<<<>>><<>>><<<<>>>><<<<>>>><>><<>>>><<>><><<<<>><<><<<>>><>>><<<<><>>><><<<>>><<><<<>><>><<<<>><><<<<>><<<>><<<<><<<>><>>>><<<>>>><<<>>><<<<>><<<>>><<<><<<><<<>><<<<><<>>>><<<><<>><>>><>>><>><<<>><<<>><<<<>>><<<<>>><<<<><<>><>><<<>>>><<<>>>><>>><>><<<<>>>><<<>>><<<>>>><>><<<<>>><><<<<>>><<><>>><<<<>><>>><<<<>>>><>>><<>>>><<>><>>><<>>><<>><<<><<<<>><>>><<>><<<><><>>>><<>>><<<<>>>><<<><<<<>><>><<<>>><<<>><<<>>>><<<><><<<<>>><<<><<<><<><<>><<>>>><<<<><>>><<<>>>><<<>>>><<<>>>><<<>><>><>>><<<<><<<<>><<<<>>>><>>><<>>>><<<<><<>><>><<><>>>><>>><<<>><<<>><>><<<>><<<><<<<>>>><<<<><<<>><<>><<><<<<><<>>><<<>>>><<<><<<<>><<<><>><<<>>>><<><<>>><<<<>><<<<>>>><>>>><<>>>><<<>>><<><<<>>>><>><<<>>><>><<<>>>><<<<>>>><<<>><>>>><<<<>>><<<<>>><>>><<<>>>><<><<<<><<>>>><>>>><<<>><>><>>><<><><>>><<>>><>>>><<<<>>>><<<<>>><>><<<>><<>><<>><<><<<>>><<<><<<<>>><<<>>>><<>><<<>>>><<>>><<<<>><<>>><<<<><<><><<<<><<<><<<>>>><><<<><>>>><<>>>><<<<>><<<><<>>><<>><<<<>><<<<>><<><>><>>><<<>>>><><<<><<<<>>>><<<<><>>><<><<>>>><>><>>><<<<>>>><>>>><<<<><<>>><>>>><<<<>>>><<<<>>><<<><<<<>>><<<<>>><>>>><>>>><<><<<<><<<>>><><<>>><>>><<<>>><<<>><<>>><<<><<><<<<>>><>>>><<>>>><<<>><<>>>><>>><<><<>><<<>>>><<<><<<<>>>><<<><<>><>>><<>><<<<>><><>>>><<<<>><<>>><<>>>><<><<<<><<>><<><<<<><<<<><<>>>><>><<>>>><>>><<<>>>><<<>><<<>>><<<>><<<<>>><><<><><<<>><<>>><<<>>><>><<><>>><>><<<<>>>><>><<<<>>>><>><<<>>><<>><<>><<>>>><<><<<>>><<<<><>><<<>>>><<>>>><<<<>>><<<<>>>><<<<><<<>>>><<<><<<<><<<<>>>><>><<<>>><<<<><<><<>><<<<>>>><<<<>>>><<<<>>><>>><<>>><>>>><<<<>>>><<>><<><>>>><<>>>><<>><<<<>>>><<<<>>>><<<>>>><<>>><<>>><<<>>>><<>>>><<<><>><<<><<><<>><<<<>>><>>>><<<<>>><><<<>>><<>>>><>>><<>>>><<>>><<>>>><>>><<<<>>><<<><>>><<<<>>>><<<>>><><<<<>><<<<>>><<>>>><<<><><><<<>>><<<>>><>><<<>><<<>>><<<>>>><>>>><<<<>>><>>><<<><>><<>><<<<>>>><<<>><>>><<>>>><<<>>><><<<<>>><<<>>>><>><>>><<><<<>>>><<<<>>><<<>>><<>>><<<>>>><<<<>>><>>>><<<<><<<>>><<<>>>><>><<<>>><<><<<<>><<>><<><<<<><<<><<>>>><<>><<><<<>><<<<>>>><<><<<>>><<<>>><<<<>>><<<<><<<<>><<<><<>>>><<<<>><<<>>><><<>>>><<>>><<<<><<<>><<>><<>><<>><<>>><<<>>>><<>>>><<<>><>>>><<<>><<>>><<<<><<<>>><<<<>><<<>>>><>>>><<<>><<<<><<<>>><>><<<>>>><>><>>><><<<<><<<<>>><<<<>>><<<>>>><<>>>><<<<>>>><<<><<<>>><<>>>><<>>>><<<<>><<>>>><<>>>><<><<<<>>>><>><><<<<>>><<<<>>><<>><<><>>>><<>>>><<<>>><><<>><<>>>><<>>>><<<<>>>><<><<>><<<>><<<><>><>>>><>>><<<>><<<<><<<<><<><<>>>><<<<><>>>><<<<>>><<<<>>>><<<<>>><<<>>><<<<><><<<<>><<<<>>>><<>><>>><<<<><<<>>>><<<>>><>>><<>>>><<<<>>><<>>>><>>>><<<><<<>>>><<>>>><<<<>>><>>><<<><<><><<>><<>>><<><<<<><<>>>><<<><<<><<<>><<<<>><<<>>>><>>><<><<<<>>><>>>><>><<<<>>><<<>>>><>><>><<<><<<<>>><>>>><>>><>><<<<>>><<<<>>>><<>>>><<>>><>>><<><<<>>><<<>><<>>><><>>>><<><>><>><<<><<>>><><<<><<<><>>>><<<>><<>>>><>>><>>>><<<>>>><>>>><<<><<<<>>><<<>><<<>><<<<>><<<>>>><>>>><<<><<<>>><<<<>>>><<>>>><>>><<><<><<<>>>><<><>><>><<<<>><<<><<<>>>><>><>><<<<><<<<><<><<<<>>><<<>><<<><<>>><<>>><<>><<<><<>>>><<><<<<>>>><<<>>>><<>><>>>><<>>>><<<>>>><>>><<<<>>><<<<>>><<<>>><<<>>>><<>>><<>>>><<<><<>>>><<<>>><<<>><>>><<<<>>><<>><<<<>><<<>><<<>>>><<<<>><>>>><>><<<<>>><<>>><><<<<>><<<><<<<><>>><>>>><>><<<>>>><<><<<<>>><>>>><<>>><<<<>><<<><<<>><<<>>><<>>><<<<>>>><<>><>><<<>>><><<>>><>>><<<>><<<><>>><>><<<<><<<>><<<><><<<>>>><<<<>><<>>>><>>>><<>><<<<>><<<><<<><<>>><<<><>><><<<>>><<<<><<<<>>>><<<<><<<>>>><<<><<>>>><<>>>><<<<>><<<><<<<>>><<<<>>><<<>>><>><<>>>><<<><<>><<<<>>>><<<>><>>><<<>>>><<<><<<<><<><<<><><<><<>><<>><<<<><<<<>><<<<>>><><<<<><>><<>><>>><>>>><<<>>><<<>>><<<>>><<<><<<>>>><>>>><<<>><<<>><><<<>>>><<<<>>><<>><<<<>>><<>>><<><>>><<<<><<<>><>>><<>>>><>>><<<<><<<>>><<><<>><<>><<<>><<<<>><<>><>><<>>><><>>><<<>>>><<<>>>><<<<>><<<>>><<>>><<<>>>><<<>>><><<<>><><<>>><<<>>><<<><>>>><>>>><<<>><<<<><><<>><<>>>><><<<<>>>><<<<>>>><<<<>><<<><>>><<<<>>><<<<>>><>><<><>>>><>><<>>>><>>>><<<<>><<<>><><<<>>><><><<<>>>><<<><<>><<>>>><<<<>><<<>>><<>>>><<<<>><<<<>><<>>>><<>>><>><<>><<<<>><<>>>><<><><<<>>><<>><<>>><<<>>><<<>>><<<><<<<>>>><<<<>><<<>><>>><<<<>><><<<<>>><<>>>><<<>>>><<>>>><<<>>>><><<<>>><<<<>>><<>><<<<>>>><<<<>>><<<<>>><<<<>>><>>>><<<>><<<>>>><<<>>>><>><<<<>>>><>>>><>><<<>>>><<<>>>><>>><<><<<<>>>><><<<<>><<<>>>><<<><<<>>><<><<<><<>><<<<>><<<>>><>><<<>>><>>>><>>><<<<>>>><><>><<<>>><<<><<<<>>><><<<><<>><>>>><>>><<<>>>><<<<>>>><<<<>>><<>>><<>>><<<>><<<>>>><<<>>>><><<>><<<><>><<<>>><<<>><<<<><<>>><>>><<>>><<>><>>>><<>><><>>>><<><>><>>><<>>><<<<>><<<>><<>><<><<<<>>><>>><>>>><>>><>>>><<<<>>>><<>>><<<<>>>><<<>><<>><<<>><<<<>>><<>><<>>><<<<>>><>>>><<>>>><<>><<>>><<<>>>><><<<<>>>><<<>>><<><<<<>>>><<><<<<>>>><<>><<<<><>><<>>><<<>>><<>><<<<><<>><<><<<<><")
rocks=[
    [
        ["####"]
    ],
    [
        [".#."],
        ["###"],
        [".#."]
    ],

    [
        ["###"],
        ["..#"],
        ["..#"]
    ],

    [
        ["#"],
        ["#"],
        ["#"],
        ["#"]
    ],

    [
        ["##"],
        ["##"]
    ]
]

# change rocks to list of chars
for i in range(len(rocks)):
    for j in range(len(rocks[i])):
        rocks[i][j]=list(rocks[i][j][0])

print(rocks)


def checkOverlap(rock,position,chart):
    # check if rock overlaps with chart
    # position is top left corner of rock
    for i in range(len(rock)):
        for j in range(len(rock[i])):
            if rock[i][j]=="#" and chart[position[1]+i][position[0]+j]=="#":
                return True

    return False

def visualize(chart):
    #print in reverse line by line
    for line in chart[::-1]:
        print(line)
def visualizeRock(rock):
    for line in rock:
        print("".join(line))

def findYcols(chart):
    # find heighest y for each x
    ycols=[0 for i in range(len(chart[0]))]
    for i in range(len(chart[0])):
        for n,j in enumerate(chart[::-1]):
            if j[i]=="#":
                ycols[i]=n
                break
    #print(ycols)
    return ycols

def saveRock(rock,position,chart):
    # save rock to chart
    # position is top left corner of rock
    for i in range(len(rock)):
        for j in range(len(rock[i])):
            if rock[i][j]=="#":
                chart[position[1]+i]=chart[position[1]+i][:position[0]+j]+"#"+chart[position[1]+i][position[0]+j+1:]

    # find new ymax
    for line in chart[::-1]:
        if "#" in line:
            ymax=len(chart)-chart[::-1].index(line)
            break
    return chart,ymax

MinX,MaxX=0,6
chart=["."*(MaxX-MinX+1) for i in range(6)]
#visualize(chart)
ymax=0
counter=-1
totalRocks=1000000000000
history=dict()
nrocks=-1
while True:
    if totalRocks==nrocks:
        print(ymax)
        exit()
#for i in tqdm.tqdm(range(1000000000000)):
    nrocks+=1
    # spawn is bottom left corner of rock
    spawn=[2,ymax+3]
    rock=rocks[nrocks%len(rocks)]
    if counter%len(movements)==0:
        state=findYcols(chart)
        stkey="-".join([str(st) for st in state])
        if stkey in history and rock==rocks[history[stkey][1]%len(rocks)]:
            print(f"Found repeat at {nrocks}")
            print(f"Current ymax: {ymax}, previous ymax: {history[stkey][0]}")
            diff=ymax-history[stkey][0]
            diffCounter=counter-history[stkey][2]
            steps=nrocks-history[stkey][1]
            print(f"Diff: {diff}, steps: {steps}")
            repeats=(1000000000000-nrocks)//steps
            print(f"Repeats: {repeats}")
            ymax+=diff*repeats
            counter+=diffCounter*repeats
            nrocks+=steps*repeats
            print(f"New ymax: {ymax}, new counter: {counter}, new nrocks: {nrocks}")
            exit()
        else:
            history[stkey]=[ymax,nrocks,counter]
    # make sure chart is big enough, if not, increase size of chart by adding rows 
    if spawn[1]+len(rock)>len(chart):
        chart+=["."*(MaxX-MinX+1) for i in range(spawn[1]+len(rock)-len(chart))]
    #visualizeRock(rock)

    while True:
        #print(spawn)
        counter+=1
        movement=movements[counter%len(movements)]
        if movement=="<":
            if spawn[0]>MinX and not checkOverlap(rock,[spawn[0]-1,spawn[1]],chart):
                spawn[0]-=1
                #print(f"Moved {rocks.index(rock)} left")
        elif movement==">":
            #print(len(rock[0]))
            if (spawn[0]+len(rock[0]))<=MaxX and not checkOverlap(rock,[spawn[0]+1,spawn[1]],chart):
                spawn[0]+=1
                #print(f"Moved {rocks.index(rock)} right")
        # check if rock can fall, note that spawn is bottom left corner of rock
        if spawn[1]-1>=0 and not checkOverlap(rock,[spawn[0],spawn[1]-1],chart):
            spawn[1]-=1
            #print(f"Moved {rocks.index(rock)} down")
        else:
            # save rock to chart, not that falling decreases y
            #print(f"Saved {rocks.index(rock)} at {spawn}")
            chart,ymax=saveRock(rock,spawn,chart)
            #print(spawn)
            break



    #visualize(chart)
    #print("")
print(ymax)
